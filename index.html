<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Overcast</title>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=ваш_api_ключ&lang=ru_RU" type="text/javascript"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #5D8AA8;
            --secondary-color: #87CEEB;
            --text-color: #FFFFFF;
            --card-bg: rgba(255, 255, 255, 0.15);
            --card-border: rgba(255, 255, 255, 0.3);
            --header-bg: rgba(255, 255, 255, 0.1);
            --header-height: 70px;
            --card-radius: 16px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        ::-webkit-scrollbar {
            display: none;
        }

        body {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--text-color);
            min-height: 100vh;
            padding: 0;
            transition: var(--transition);
            overflow-x: hidden;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        body.settings-open {
            overflow: hidden;
        }

        /* Погодные темы */
        body.clear {
            background: linear-gradient(135deg, #7BA7CC, #A8D1F0, #D4EBFF);
        }

        body.clouds {
            background: linear-gradient(135deg, #7F8C8D, #A6B2B3, #CBD5D6);
        }

        body.rain {
            background: linear-gradient(135deg, #4A6572, #6A7F8F, #8FA3B1);
        }

        body.snow {
            background: linear-gradient(135deg, #B0C4DE, #D1E0F0, #E8F0F8);
            color: #4A5568;
        }

        body.thunderstorm {
            background: linear-gradient(135deg, #3A506B, #5A6F8A, #7A8FA9);
        }

        body.drizzle {
            background: linear-gradient(135deg, #6A93B8, #9BC5E8, #C6E2FF);
        }

        body.mist, body.fog, body.haze {
            background: linear-gradient(135deg, #95A5A6, #BDC3C7, #D5DBDB);
            color: #4A5568;
        }

        /* Ночные темы */
        body.night {
            background: linear-gradient(135deg, #2D3E50, #4A6572, #6A7F8F);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: var(--header-height);
            background: var(--header-bg);
            backdrop-filter: blur(20px);
            padding: 0 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--card-border);
        }

        .logo {
            display: none;
        }

        .location-search {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            position: relative;
        }

        .find-me-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 20px;
            border: none;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            color: var(--text-color);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .find-me-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .search-container {
            flex: 1;
            max-width: 400px;
            position: relative;
        }

        .search-bar {
            width: 100%;
            padding: 10px 16px;
            border-radius: 20px;
            border: none;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            color: var(--text-color);
            font-size: 14px;
            outline: none;
            transition: var(--transition);
        }

        .search-bar::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .search-bar:focus {
            background: rgba(255, 255, 255, 0.25);
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            margin-top: 5px;
            z-index: 1000;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .suggestion-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .suggestion-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .suggestion-details {
            font-size: 12px;
            opacity: 0.8;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            color: var(--text-color);
        }

        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .burger-icon {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            width: 18px;
            height: 14px;
        }

        .burger-line {
            width: 100%;
            height: 2px;
            background-color: currentColor;
            border-radius: 1px;
            transition: var(--transition);
        }

        .settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .settings-panel {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--card-radius);
            padding: 25px;
            border: 1px solid var(--card-border);
            width: 320px;
            max-width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            color: var(--text-color);
        }

        .settings-item {
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .theme-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .theme-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .theme-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .theme-selector {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            position: relative;
            transition: var(--transition);
        }

        .theme-option.active .theme-selector {
            border-color: var(--text-color);
        }

        .theme-option.active .theme-selector::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: var(--text-color);
            border-radius: 50%;
        }

        .language-selector, .units-selector {
            position: relative;
        }

        .selector-btn {
            width: 100%;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--text-color);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .selector-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .selector-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            margin-top: 5px;
            display: none;
            z-index: 1001;
            overflow: hidden;
        }

        .selector-option {
            padding: 10px 12px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .selector-option:last-child {
            border-bottom: none;
        }

        .selector-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .settings-link {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            color: var(--text-color);
            text-decoration: none;
            transition: var(--transition);
        }

        .settings-link:hover {
            opacity: 0.8;
        }

        .main-content {
            padding: 30px 0;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .precipitation-map {
            height: 350px;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--card-radius);
            margin-bottom: 30px;
            border: 2px solid var(--card-border);
            overflow: hidden;
            position: relative;
        }

        #map {
            height: 100%;
            width: 100%;
            border-radius: var(--card-radius);
        }

        .map-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--text-color);
            font-size: 16px;
            font-weight: 600;
            z-index: 100;
        }

        .weather-content {
            display: flex;
            gap: 40px;
            align-items: flex-start;
            margin-bottom: 40px;
        }

        .weather-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: var(--card-radius);
            padding: 25px;
            border: 1px solid var(--card-border);
            height: fit-content;
            text-align: center;
        }

        .temperature-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 5px;
        }

        .temperature-icon {
            font-size: 48px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .temperature {
            font-size: 84px;
            font-weight: 900;
            line-height: 1;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
        }

        .feels-like {
            font-size: 18px;
            font-weight: 700;
            margin: 8px 0;
            opacity: 0.9;
        }

        .weather-description {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            text-transform: capitalize;
        }

        .weather-details {
            background: transparent;
            padding: 0;
            margin-top: 10px;
            width: 100%;
        }

        .weather-detail-item {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
            line-height: 1.4;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .tiles-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .section-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            text-align: center;
            width: 100%;
        }

        .tiles-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            width: 100%;
        }

        .tile {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--card-radius);
            padding: 18px;
            border: 1px solid var(--card-border);
            transition: var(--transition);
        }

        .tile:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .tile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .tile-title {
            font-size: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tile-content {
            font-size: 14px;
            line-height: 1.4;
        }

        .tile-content-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }

        .tile-content-item:last-child {
            margin-bottom: 0;
        }

        /* ПРОГНОЗ НА НЕДЕЛЮ - КРУПНЫЙ И ПО ЦЕНТРУ */
        .weekly-forecast {
            margin-top: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .weekly-title {
            font-size: 22px;
            margin-bottom: 20px;
            font-weight: 700;
            text-align: center;
            width: 100%;
        }

        .days-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
            width: 100%;
            flex-wrap: wrap;
        }

        .day-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--card-radius);
            padding: 20px;
            text-align: center;
            border: 1px solid var(--card-border);
            transition: var(--transition);
            min-width: 120px;
            flex: 1;
            max-width: 140px;
        }

        .day-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .day-name {
            font-size: 18px;
            margin-bottom: 12px;
            font-weight: 700;
        }

        .day-icon {
            font-size: 32px;
            margin-bottom: 12px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .day-temp {
            font-size: 24px;
            font-weight: 700;
        }

        .daylight-info {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--card-radius);
            padding: 20px;
            border: 1px solid var(--card-border);
            width: 100%;
        }

        .daylight-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .daylight-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .daylight-item:last-child {
            border-bottom: none;
        }

        .daylight-label {
            font-weight: 600;
            opacity: 0.9;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .daylight-value {
            font-weight: 700;
            font-size: 14px;
        }

        /* ДОПОЛНИТЕЛЬНАЯ ИНФОРМАЦИЯ */
        .additional-info {
            margin-top: 30px;
            width: 100%;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .info-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--card-radius);
            padding: 18px;
            border: 1px solid var(--card-border);
            transition: var(--transition);
        }

        .info-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .info-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-content {
            font-size: 14px;
            line-height: 1.4;
        }

        /* ЕЩЕ БОЛЬШЕ ИНФОРМАЦИИ */
        .extended-info {
            margin-top: 30px;
            width: 100%;
        }

        .extended-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        /* МОБИЛЬНАЯ АДАПТАЦИЯ */
        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            header {
                padding: 0 15px;
                height: 60px;
            }
            
            .logo {
                display: none;
            }
            
            .location-search {
                order: 2;
                flex: 1;
                margin: 0;
                justify-content: center;
            }
            
            .find-me-btn {
                padding: 8px;
                order: 1;
                margin-right: 10px;
            }
            
            .find-me-text {
                display: none;
            }
            
            .search-container {
                max-width: none;
                order: 2;
            }
            
            .header-controls {
                order: 3;
                margin-left: 10px;
            }
            
            .weather-content {
                flex-direction: column;
                gap: 20px;
            }
            
            .weather-main {
                width: 100%;
                padding: 20px;
                align-items: center;
                text-align: center;
            }
            
            .temperature {
                font-size: 72px;
            }
            
            .tiles-container {
                grid-template-columns: 1fr;
                width: 100%;
            }
            
            .tile {
                width: 100%;
                margin: 0;
            }
            
            .precipitation-map {
                height: 250px;
            }
            
            .daylight-grid {
                grid-template-columns: 1fr;
            }
            
            .info-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .extended-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .days-container {
                justify-content: center;
            }
            
            .day-card {
                min-width: 100px;
                padding: 15px;
            }
            
            .day-name {
                font-size: 16px;
            }
            
            .day-temp {
                font-size: 20px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 10px;
            }
            
            header {
                padding: 0 10px;
            }
            
            .weather-main {
                padding: 15px;
            }
            
            .temperature {
                font-size: 60px;
            }
            
            .temperature-icon {
                font-size: 36px;
                width: 50px;
                height: 50px;
            }
            
            .weather-description {
                font-size: 20px;
            }
            
            .days-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .precipitation-map {
                height: 200px;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .extended-grid {
                grid-template-columns: 1fr;
            }
            
            .day-card {
                min-width: 80px;
                padding: 12px;
            }
            
            .day-name {
                font-size: 14px;
            }
            
            .day-temp {
                font-size: 18px;
            }
            
            .section-title {
                font-size: 20px;
            }
            
            .tile, .info-card {
                padding: 15px;
            }
        }

        /* Дополнительные улучшения для очень маленьких экранов */
        @media (max-width: 360px) {
            .temperature {
                font-size: 50px;
            }
            
            .temperature-icon {
                font-size: 30px;
                width: 40px;
                height: 40px;
            }
            
            .weather-description {
                font-size: 18px;
            }
            
            .days-container {
                gap: 10px;
            }
            
            .day-card {
                min-width: 70px;
                padding: 10px;
            }
            
            .day-name {
                font-size: 13px;
            }
            
            .day-temp {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">Weather Overcast</div>
        <div class="location-search">
            <button class="find-me-btn" id="locate-btn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z" fill="white"/>
                </svg>
                <span class="find-me-text">Найти меня</span>
            </button>
            <div class="search-container">
                <input type="text" class="search-bar" id="city-search" placeholder="Поиск мест">
                <div class="search-suggestions" id="search-suggestions"></div>
            </div>
        </div>
        <div class="header-controls">
            <button class="icon-btn" id="settings-btn">
                <div class="burger-icon">
                    <div class="burger-line"></div>
                    <div class="burger-line"></div>
                    <div class="burger-line"></div>
                </div>
            </button>
        </div>
    </header>

    <div class="settings-overlay" id="settings-overlay">
        <div class="settings-panel">
            <div class="settings-item">
                <div class="settings-title">Тема</div>
                <div class="theme-options">
                    <div class="theme-option active" data-theme="dynamic">
                        <div class="theme-selector"></div>
                        <span class="theme-text">Динамичная</span>
                    </div>
                    <div class="theme-option" data-theme="light">
                        <div class="theme-selector"></div>
                        <span class="theme-text">Светлая</span>
                    </div>
                    <div class="theme-option" data-theme="dark">
                        <div class="theme-selector"></div>
                        <span class="theme-text">Тёмная</span>
                    </div>
                </div>
            </div>
            
            <div class="settings-item">
                <div class="units-selector">
                    <div class="settings-title">Единицы температуры</div>
                    <button class="selector-btn" id="units-btn">
                        <span id="current-units">Цельсий (°C)</span>
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <div class="selector-dropdown" id="units-dropdown">
                        <div class="selector-option" data-units="celsius">Цельсий (°C)</div>
                        <div class="selector-option" data-units="fahrenheit">Фаренгейт (°F)</div>
                        <div class="selector-option" data-units="kelvin">Кельвин (K)</div>
                    </div>
                </div>
            </div>
            
            <div class="settings-item">
                <div class="language-selector">
                    <div class="settings-title">Выбор языка</div>
                    <button class="selector-btn" id="language-btn">
                        <span id="current-lang">Русский</span>
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <div class="selector-dropdown" id="language-dropdown">
                        <div class="selector-option" data-lang="ru">Русский</div>
                        <div class="selector-option" data-lang="en">English</div>
                    </div>
                </div>
            </div>
            
            <div class="settings-item">
                <a href="#" class="settings-link">Сообщить о баге</a>
            </div>
            
            <div class="settings-item">
                <a href="https://t.me/prelude_commit" class="settings-link">Связаться с разработчиком</a>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="main-content">
            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <div>Загрузка данных о погоде...</div>
            </div>

            <div class="precipitation-map">
                <div id="map"></div>
                <div class="map-loading">Загрузка Яндекс.Карт...</div>
            </div>

            <div class="weather-content">
                <div class="weather-main">
                    <div class="temperature-container">
                        <div class="temperature-icon" id="temperature-icon"></div>
                        <div class="temperature" id="current-temp">--°</div>
                    </div>
                    <div class="feels-like" id="feels-like">Ощущается как --°</div>
                    <div class="weather-description" id="weather-description">--</div>
                    <div class="weather-details">
                        <div class="weather-detail-item" id="rain-info">
                            <span>●</span>
                            <span>--</span>
                        </div>
                        <div class="weather-detail-item" id="wind-info">
                            <span>●</span>
                            <span>--</span>
                        </div>
                    </div>
                </div>

                <div class="tiles-section">
                    <h2 class="section-title">Информация о погоде</h2>
                    <div class="tiles-container">
                        <div class="tile">
                            <div class="tile-header">
                                <div class="tile-title">
                                    <span>●</span>
                                    <span>Ветер</span>
                                </div>
                            </div>
                            <div class="tile-content" id="wind-details">
                                <div class="tile-content-item">
                                    <span>●</span>
                                    <span>-- км/ч</span>
                                </div>
                                <div class="tile-content-item">
                                    <span>●</span>
                                    <span>--</span>
                                </div>
                                <div class="tile-content-item">
                                    <span>●</span>
                                    <span>Порывы до -- км/ч</span>
                                </div>
                            </div>
                        </div>
                        <div class="tile">
                            <div class="tile-header">
                                <div class="tile-title">
                                    <span>●</span>
                                    <span>Давление</span>
                                </div>
                            </div>
                            <div class="tile-content" id="pressure-details">
                                <div class="tile-content-item">
                                    <span>●</span>
                                    <span>-- мм рт. ст.</span>
                                </div>
                                <div class="tile-content-item">
                                    <span>●</span>
                                    <span>--</span>
                                </div>
                            </div>
                        </div>
                        <div class="tile">
                            <div class="tile-header">
                                <div class="tile-title">
                                    <span>●</span>
                                    <span>Влажность</span>
                                </div>
                            </div>
                            <div class="tile-content" id="humidity-details">
                                <div class="tile-content-item">
                                    <span>●</span>
                                    <span>--%</span>
                                </div>
                                <div class="tile-content-item">
                                    <span>●</span>
                                    <span>--</span>
                                </div>
                            </div>
                        </div>
                        <div class="tile">
                            <div class="tile-header">
                                <div class="tile-title">
                                    <span>●</span>
                                    <span>УФ-индекс</span>
                                </div>
                            </div>
                            <div class="tile-content" id="uv-details">
                                <div class="tile-content-item">
                                    <span>●</span>
                                    <span>--</span>
                                </div>
                                <div class="tile-content-item">
                                    <span>●</span>
                                    <span>--</span>
                                </div>
                            </div>
                        </div>
                        <div class="tile">
                            <div class="tile-header">
                                <div class="tile-title">
                                    <span>●</span>
                                    <span>Геомагнитное поле</span>
                                </div>
                            </div>
                            <div class="tile-content" id="geomagnetic-details">
                                <div class="tile-content-item">
                                    <span>●</span>
                                    <span>--</span>
                                </div>
                                <div class="tile-content-item">
                                    <span>●</span>
                                    <span>-- кп</span>
                                </div>
                            </div>
                        </div>
                        <div class="tile">
                            <div class="tile-header">
                                <div class="tile-title">
                                    <span>●</span>
                                    <span>Пыльца</span>
                                </div>
                            </div>
                            <div class="tile-content" id="pollen-details">
                                <div class="tile-content-item">
                                    <span>●</span>
                                    <span>--</span>
                                </div>
                                <div class="tile-content-item">
                                    <span>●</span>
                                    <span>--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ПРОГНОЗ НА НЕДЕЛЮ - КРУПНЫЙ И ПО ЦЕНТРУ -->
                <div class="daylight-info">
                    <div class="daylight-grid">
                        <div>
                            <div class="daylight-item">
                                <span class="daylight-label">
                                    <span>●</span>
                                    <span>Восход</span>
                                </span>
                                <span class="daylight-value" id="sunrise">--:--</span>
                            </div>
                            <div class="daylight-item">
                                <span class="daylight-label">
                                    <span>●</span>
                                    <span>Продолжительность</span>
                                </span>
                                <span class="daylight-value" id="daylight-duration">-- ч -- мин</span>
                            </div>
                            <div class="daylight-item">
                                <span class="daylight-label">
                                    <span>●</span>
                                    <span>Закат</span>
                                </span>
                                <span class="daylight-value" id="sunset">--:--</span>
                            </div>
                        </div>
                        <div>
                            <div class="daylight-item">
                                <span class="daylight-label">
                                    <span>●</span>
                                    <span>УФ-индекс</span>
                                </span>
                                <span class="daylight-value" id="uv-index">--, --</span>
                            </div>
                            <div class="daylight-item">
                                <span class="daylight-label">
                                    <span>●</span>
                                    <span>Видимость</span>
                                </span>
                                <span class="daylight-value" id="visibility">-- км</span>
                            </div>
                            <div class="daylight-item">
                                <span class="daylight-label">
                                    <span>●</span>
                                    <span>Облачность</span>
                                </span>
                                <span class="daylight-value" id="cloudiness">--%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ДОПОЛНИТЕЛЬНАЯ ИНФОРМАЦИЯ -->
            <div class="additional-info">
                <h2 class="section-title">Дополнительная информация</h2>
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-title">
                            <span>●</span>
                            <span>Качество воздуха</span>
                        </div>
                        <div class="info-content" id="air-quality">
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>Индекс AQI: --</span>
                            </div>
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>--</span>
                            </div>
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>PM2.5: -- мкг/м³</span>
                            </div>
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>PM10: -- мкг/м³</span>
                            </div>
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-title">
                            <span>●</span>
                            <span>Луна</span>
                        </div>
                        <div class="info-content" id="moon-info">
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>Фаза: --</span>
                            </div>
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>Освещенность: --%</span>
                            </div>
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>Восход: --:--</span>
                            </div>
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>Закат: --:--</span>
                            </div>
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-title">
                            <span>●</span>
                            <span>Осадки</span>
                        </div>
                        <div class="info-content" id="precipitation-info">
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>Вероятность: --%</span>
                            </div>
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>Интенсивность: -- мм/ч</span>
                            </div>
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>Тип: --</span>
                            </div>
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>Облачность: --%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ЕЩЕ БОЛЬШЕ ИНФОРМАЦИИ -->
            <div class="extended-info">
                <h2 class="section-title">Расширенная метеоинформация</h2>
                <div class="extended-grid">
                    <div class="info-card">
                        <div class="info-title">
                            <span>●</span>
                            <span>Точка росы</span>
                        </div>
                        <div class="info-content" id="dew-point">
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>--°C</span>
                            </div>
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>Комфортно</span>
                            </div>
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-title">
                            <span>●</span>
                            <span>Видимость</span>
                        </div>
                        <div class="info-content" id="visibility-extended">
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>-- км</span>
                            </div>
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>Отличная</span>
                            </div>
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-title">
                            <span>●</span>
                            <span>Ультрафиолет</span>
                        </div>
                        <div class="info-content" id="uv-extended">
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>Индекс: --</span>
                            </div>
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>Защита: --</span>
                            </div>
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-title">
                            <span>●</span>
                            <span>Атмосфера</span>
                        </div>
                        <div class="info-content" id="atmosphere">
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>Давление: -- гПа</span>
                            </div>
                            <div class="tile-content-item">
                                <span>●</span>
                                <span>Стабильность: --</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Конфигурация
        const API_KEY = 'b5f3fc6e8095ecb49056466acb6c59da';
        const BASE_URL = 'https://api.openweathermap.org/data/2.5';

        // Глобальные переменные
        let map = null;
        let userPlacemark = null;
        let currentLang = 'ru';
        let currentUnits = 'celsius';
        let currentTheme = 'dynamic';

        // База данных для автодополнения
        const cityDatabase = [
            { name: "Санкт-Петербург", region: "Санкт-Петербург и Ленинградская область", type: "город" },
            { name: "Новоселье", region: "Ленинградская область", type: "городской посёлок", distance: "20 км" },
            { name: "Янино-1", region: "Ленинградская область", type: "городской посёлок", distance: "14 км" },
            { name: "Песочный", region: "Санкт-Петербург", type: "посёлок", distance: "22 км" },
            { name: "Павловск", region: "Санкт-Петербург", type: "город", distance: "29 км" },
            { name: "имени Свердлова", region: "Ленинградская область", type: "городской посёлок", distance: "24 км" },
            { name: "Москва", region: "Московская область", type: "город" },
            { name: "Питер", region: "Санкт-Петербург", type: "город" },
            { name: "Подкаменка", region: "Ленинградская область", type: "деревня", distance: "35 км" },
            { name: "Выборг", region: "Ленинградская область", type: "город", distance: "130 км" },
            { name: "Гатчина", region: "Ленинградская область", type: "город", distance: "45 км" },
            { name: "Кронштадт", region: "Санкт-Петербург", type: "город", distance: "30 км" }
        ];

        // Переводы
        const translations = {
            ru: {
                'feels_like': 'Ощущается как',
                'gusts': 'Порывы до',
                'normal': 'Нормальное',
                'very_high': 'Очень высокая',
                'no_protection': 'Защита не нужна',
                'calm': 'Спокойное',
                'no_activity': 'Нет активности',
                'no_allergy': 'Риска аллергии нет',
                'weather_info': 'Информация о погоде',
                'wind': 'Ветер',
                'pressure': 'Давление',
                'humidity': 'Влажность',
                'uv_index': 'УФ-индекс',
                'geomagnetic': 'Геомагнитное поле',
                'pollen': 'Пыльца',
                'weekly_forecast': 'Прогноз на неделю',
                'sunrise': 'Восход',
                'daylight': 'Продолжительность',
                'sunset': 'Закат',
                'visibility': 'Видимость',
                'cloudiness': 'Облачность',
                'find_me': 'Найти меня',
                'search_places': 'Поиск мест',
                'loading_weather': 'Загрузка данных о погоде...',
                'loading_maps': 'Загрузка Яндекс.Карт...',
                'no_precipitation': 'Без осадков',
                'precipitation': 'Осадки',
                'dynamic_theme': 'Динамичная',
                'light_theme': 'Светлая',
                'dark_theme': 'Тёмная',
                'temperature_units': 'Единицы температуры',
                'language_selection': 'Выбор языка',
                'report_bug': 'Сообщить о баге',
                'contact_developer': 'Связаться с разработчиком',
                'additional_info': 'Дополнительная информация',
                'air_quality': 'Качество воздуха',
                'moon': 'Луна',
                'precipitation': 'Осадки',
                'aqi_index': 'Индекс AQI',
                'moon_phase': 'Фаза',
                'illumination': 'Освещенность',
                'probability': 'Вероятность',
                'intensity': 'Интенсивность',
                'extended_weather': 'Расширенная метеоинформация',
                'dew_point': 'Точка росы',
                'atmosphere': 'Атмосфера',
                'comfort_level': 'Уровень комфорта'
            },
            en: {
                'feels_like': 'Feels like',
                'gusts': 'Gusts up to',
                'normal': 'Normal',
                'very_high': 'Very high',
                'no_protection': 'No protection needed',
                'calm': 'Calm',
                'no_activity': 'No activity',
                'no_allergy': 'No allergy risk',
                'weather_info': 'Weather Information',
                'wind': 'Wind',
                'pressure': 'Pressure',
                'humidity': 'Humidity',
                'uv_index': 'UV Index',
                'geomagnetic': 'Geomagnetic Field',
                'pollen': 'Pollen',
                'weekly_forecast': 'Weekly Forecast',
                'sunrise': 'Sunrise',
                'daylight': 'Duration',
                'sunset': 'Sunset',
                'visibility': 'Visibility',
                'cloudiness': 'Cloudiness',
                'find_me': 'Find me',
                'search_places': 'Search places',
                'loading_weather': 'Loading weather data...',
                'loading_maps': 'Loading Yandex.Maps...',
                'no_precipitation': 'No precipitation',
                'precipitation': 'Precipitation',
                'dynamic_theme': 'Dynamic',
                'light_theme': 'Light',
                'dark_theme': 'Dark',
                'temperature_units': 'Temperature Units',
                'language_selection': 'Language Selection',
                'report_bug': 'Report a Bug',
                'contact_developer': 'Contact Developer',
                'additional_info': 'Additional Information',
                'air_quality': 'Air Quality',
                'moon': 'Moon',
                'precipitation': 'Precipitation',
                'aqi_index': 'AQI Index',
                'moon_phase': 'Phase',
                'illumination': 'Illumination',
                'probability': 'Probability',
                'intensity': 'Intensity',
                'extended_weather': 'Extended Weather Information',
                'dew_point': 'Dew Point',
                'atmosphere': 'Atmosphere',
                'comfort_level': 'Comfort Level'
            }
        };

        const weatherTranslations = {
            ru: {
                'clear sky': 'Ясно',
                'few clouds': 'Небольшая облачность',
                'scattered clouds': 'Рассеянные облака',
                'broken clouds': 'Облачно с прояснениями',
                'overcast clouds': 'Пасмурно',
                'shower rain': 'Ливень',
                'rain': 'Дождь',
                'thunderstorm': 'Гроза',
                'snow': 'Снег',
                'mist': 'Туман',
                'light rain': 'Небольшой дождь'
            },
            en: {
                'clear sky': 'Clear sky',
                'few clouds': 'Few clouds',
                'scattered clouds': 'Scattered clouds',
                'broken clouds': 'Broken clouds',
                'overcast clouds': 'Overcast',
                'shower rain': 'Shower rain',
                'rain': 'Rain',
                'thunderstorm': 'Thunderstorm',
                'snow': 'Snow',
                'mist': 'Mist',
                'light rain': 'Light rain'
            }
        };

        // Основные функции
        function getTranslation(key) {
            return translations[currentLang][key] || key;
        }

        function translateWeather(description) {
            return weatherTranslations[currentLang][description] || description;
        }

        // Функция автодополнения
        function showSuggestions(query) {
            const suggestionsContainer = document.getElementById('search-suggestions');
            suggestionsContainer.innerHTML = '';
            
            if (query.length < 2) {
                suggestionsContainer.style.display = 'none';
                return;
            }
            
            const filteredCities = cityDatabase.filter(city => 
                city.name.toLowerCase().includes(query.toLowerCase()) ||
                city.region.toLowerCase().includes(query.toLowerCase())
            );
            
            if (filteredCities.length === 0) {
                suggestionsContainer.style.display = 'none';
                return;
            }
            
            filteredCities.forEach(city => {
                const item = document.createElement('div');
                item.className = 'suggestion-item';
                item.innerHTML = `
                    <div class="suggestion-name">${city.name}</div>
                    <div class="suggestion-details">${city.region}${city.distance ? ` • ${city.distance}` : ''}</div>
                `;
                item.addEventListener('click', () => {
                    document.getElementById('city-search').value = city.name;
                    suggestionsContainer.style.display = 'none';
                    getWeatherByCity(city.name);
                });
                suggestionsContainer.appendChild(item);
            });
            
            suggestionsContainer.style.display = 'block';
        }

        function updateUITexts() {
            document.querySelector('.find-me-text').textContent = getTranslation('find_me');
            document.getElementById('city-search').placeholder = getTranslation('search_places');
            document.querySelector('.loading div:last-child').textContent = getTranslation('loading_weather');
            document.querySelector('.map-loading').textContent = getTranslation('loading_maps');
            document.querySelector('.section-title').textContent = getTranslation('weather_info');
            document.querySelector('.weekly-title').textContent = getTranslation('weekly_forecast');
            
            document.querySelectorAll('.tile-title span:last-child').forEach((title, index) => {
                const titles = [
                    getTranslation('wind'),
                    getTranslation('pressure'),
                    getTranslation('humidity'),
                    getTranslation('uv_index'),
                    getTranslation('geomagnetic'),
                    getTranslation('pollen')
                ];
                if (index < titles.length) {
                    title.textContent = titles[index];
                }
            });
            
            document.querySelectorAll('.daylight-label span:last-child').forEach((label, index) => {
                const labels = [
                    getTranslation('sunrise'),
                    getTranslation('daylight'),
                    getTranslation('sunset'),
                    getTranslation('uv_index'),
                    getTranslation('visibility'),
                    getTranslation('cloudiness')
                ];
                if (index < labels.length) {
                    label.textContent = labels[index];
                }
            });
            
            document.querySelector('.settings-title:first-child').textContent = getTranslation('theme');
            document.querySelectorAll('.theme-text').forEach((text, index) => {
                const themes = [
                    getTranslation('dynamic_theme'),
                    getTranslation('light_theme'),
                    getTranslation('dark_theme')
                ];
                if (index < themes.length) {
                    text.textContent = themes[index];
                }
            });
            
            document.querySelector('.units-selector .settings-title').textContent = getTranslation('temperature_units');
            document.querySelector('.language-selector .settings-title').textContent = getTranslation('language_selection');
            
            document.querySelectorAll('.settings-link').forEach((link, index) => {
                if (index === 0) {
                    link.textContent = getTranslation('report_bug');
                } else if (index === 1) {
                    link.textContent = getTranslation('contact_developer');
                }
            });
            
            document.querySelector('.additional-info .section-title').textContent = getTranslation('additional_info');
            document.querySelectorAll('.info-title span:last-child').forEach((title, index) => {
                const titles = [
                    getTranslation('air_quality'),
                    getTranslation('moon'),
                    getTranslation('precipitation')
                ];
                if (index < titles.length) {
                    title.textContent = titles[index];
                }
            });

            document.querySelector('.extended-info .section-title').textContent = getTranslation('extended_weather');
        }

        async function getWeatherByCoords(lat, lon) {
            try {
                showLoading();
                const response = await fetch(
                    `${BASE_URL}/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=${currentLang}`
                );
                const data = await response.json();
                
                if (data.cod === 200) {
                    updateWeatherData(data);
                    updateMapLocation(lat, lon);
                    await getForecast(lat, lon);
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                console.error('Ошибка получения погоды:', error);
                alert('Ошибка: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        async function getWeatherByCity(city) {
            try {
                showLoading();
                const response = await fetch(
                    `${BASE_URL}/weather?q=${city}&appid=${API_KEY}&units=metric&lang=${currentLang}`
                );
                const data = await response.json();
                
                if (data.cod === 200) {
                    updateWeatherData(data);
                    updateMapLocation(data.coord.lat, data.coord.lon);
                    await getForecast(data.coord.lat, data.coord.lon);
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                console.error('Ошибка получения погоды:', error);
                alert('Ошибка: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        async function getForecast(lat, lon) {
            try {
                const response = await fetch(
                    `${BASE_URL}/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=${currentLang}`
                );
                const data = await response.json();
                
                if (data.cod === '200') {
                    updateForecastData(data);
                }
            } catch (error) {
                console.error('Ошибка получения прогноза:', error);
            }
        }

        function updateWeatherData(data) {
            const temp = Math.round(data.main.temp);
            const feelsLike = Math.round(data.main.feels_like);
            const weatherDesc = translateWeather(data.weather[0].description);

            document.getElementById('current-temp').textContent = `${temp}°`;
            document.getElementById('feels-like').textContent = `${getTranslation('feels_like')} ${feelsLike}°`;
            document.getElementById('weather-description').textContent = weatherDesc;

            updateTemperatureIcon(data.weather[0].main, data.main.temp);

            const windSpeed = Math.round(data.wind.speed * 3.6);
            const windGust = data.wind.gust ? Math.round(data.wind.gust * 3.6) : windSpeed + 15;
            const windDir = getWindDirection(data.wind.deg);

            document.getElementById('wind-details').innerHTML = `
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${windSpeed} км/ч</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${windDir}</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${getTranslation('gusts')} ${windGust} км/ч</span>
                </div>
            `;

            document.getElementById('wind-info').innerHTML = `
                <span>●</span>
                <span>${data.wind.speed.toFixed(1)}–${(data.wind.speed + 1).toFixed(1)} м/с, ${getTranslation('gusts')} ${windGust} км/ч</span>
            `;

            const pressure = Math.round(data.main.pressure * 0.750062);
            document.getElementById('pressure-details').innerHTML = `
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${pressure} мм рт. ст.</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${getTranslation('normal')}</span>
                </div>
            `;

            const humidity = data.main.humidity;
            const humidityText = humidity > 80 ? getTranslation('very_high') : getTranslation('normal');
            document.getElementById('humidity-details').innerHTML = `
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${humidity}%</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${humidityText}</span>
                </div>
            `;

            updateAdditionalInfo(data);
            updateThemeByWeather(data.weather[0].main, data.sys);
        }

        function updateForecastData(data) {
            const container = document.getElementById('weekly-forecast');
            container.innerHTML = '';

            const dailyForecasts = [];
            for (let i = 0; i < data.list.length; i += 8) {
                if (dailyForecasts.length < 7) {
                    dailyForecasts.push(data.list[i]);
                }
            }

            const days = currentLang === 'ru' 
                ? ['Сегодня', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Суб']
                : ['Today', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            dailyForecasts.forEach((forecast, index) => {
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                
                const weatherIcon = getWeatherIcon(forecast.weather[0].main, forecast.main.temp);
                
                dayCard.innerHTML = `
                    <div class="day-name">${days[index]}</div>
                    <div class="day-icon">${weatherIcon}</div>
                    <div class="day-temp">${Math.round(forecast.main.temp)}°</div>
                `;
                container.appendChild(dayCard);
            });
        }

        function updateAdditionalInfo(data) {
            const sunrise = new Date(data.sys.sunrise * 1000);
            const sunset = new Date(data.sys.sunset * 1000);
            const daylightMs = sunset - sunrise;
            const daylightHours = Math.floor(daylightMs / (1000 * 60 * 60));
            const daylightMinutes = Math.floor((daylightMs % (1000 * 60 * 60)) / (1000 * 60));

            document.getElementById('sunrise').textContent = formatTime(sunrise);
            document.getElementById('sunset').textContent = formatTime(sunset);
            document.getElementById('daylight-duration').textContent = 
                `${daylightHours} ч ${daylightMinutes} мин`;

            const visibility = (data.visibility / 1000).toFixed(1);
            document.getElementById('visibility').textContent = `${visibility} км`;
            document.getElementById('cloudiness').textContent = `${data.clouds.all}%`;

            const uvIndex = calculateUVIndex(data);
            document.getElementById('uv-index').textContent = `${uvIndex.index}, ${uvIndex.text}`;
            document.getElementById('uv-details').innerHTML = `
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${uvIndex.index}</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${uvIndex.protection}</span>
                </div>
            `;

            const geomagnetic = getRandomGeomagnetic();
            document.getElementById('geomagnetic-details').innerHTML = `
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${geomagnetic.status}</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${geomagnetic.value} кп</span>
                </div>
            `;

            const pollen = getRandomPollen();
            document.getElementById('pollen-details').innerHTML = `
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${pollen.activity}</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${pollen.risk}</span>
                </div>
            `;

            if (data.rain) {
                const rainVolume = data.rain['1h'] || data.rain['3h'] || 0;
                document.getElementById('rain-info').innerHTML = `
                    <span>●</span>
                    <span>${getTranslation('precipitation')}: ${rainVolume} мм</span>
                `;
            } else {
                document.getElementById('rain-info').innerHTML = `
                    <span>●</span>
                    <span>${getTranslation('no_precipitation')}</span>
                `;
            }

            updateExtraInfo(data);
        }

        function updateExtraInfo(data) {
            const aqi = Math.floor(Math.random() * 150) + 50;
            const aqiStatus = aqi < 100 ? 'Хорошее' : 'Умеренное';
            document.getElementById('air-quality').innerHTML = `
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${getTranslation('aqi_index')}: ${aqi}</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${aqiStatus}</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>PM2.5: ${(aqi/10).toFixed(1)} мкг/м³</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>PM10: ${(aqi/8).toFixed(1)} мкг/м³</span>
                </div>
            `;

            const moonPhases = currentLang === 'ru' 
                ? ['Новолуние', 'Растущая', 'Полнолуние', 'Убывающая'] 
                : ['New Moon', 'Waxing', 'Full Moon', 'Waning'];
            const moonPhase = moonPhases[Math.floor(Math.random() * moonPhases.length)];
            const illumination = Math.floor(Math.random() * 100);
            
            const moonTimes = getMoonTimes();
            document.getElementById('moon-info').innerHTML = `
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${getTranslation('moon_phase')}: ${moonPhase}</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${getTranslation('illumination')}: ${illumination}%</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>Восход: ${moonTimes.rise}</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>Закат: ${moonTimes.set}</span>
                </div>
            `;

            const probability = Math.floor(Math.random() * 100);
            const intensity = (Math.random() * 5).toFixed(1);
            const precipType = data.weather[0].main === 'Snow' ? 'Снег' : 'Дождь';
            document.getElementById('precipitation-info').innerHTML = `
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${getTranslation('probability')}: ${probability}%</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${getTranslation('intensity')}: ${intensity} мм/ч</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>Тип: ${precipType}</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>Облачность: ${data.clouds.all}%</span>
                </div>
            `;

            const dewPoint = (data.main.temp - (100 - data.main.humidity)/5).toFixed(1);
            const comfort = dewPoint < 10 ? 'Комфортно' : 'Влажно';
            document.getElementById('dew-point').innerHTML = `
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${dewPoint}°C</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${comfort}</span>
                </div>
            `;

            const visibilityExtended = (data.visibility / 1000).toFixed(1);
            const visibilityStatus = visibilityExtended > 10 ? 'Отличная' : 'Хорошая';
            document.getElementById('visibility-extended').innerHTML = `
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${visibilityExtended} км</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>${visibilityStatus}</span>
                </div>
            `;

            const uvExtended = calculateUVIndex(data);
            document.getElementById('uv-extended').innerHTML = `
                <div class="tile-content-item">
                    <span>●</span>
                    <span>Индекс: ${uvExtended.index}</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>Защита: ${uvExtended.protection}</span>
                </div>
            `;

            document.getElementById('atmosphere').innerHTML = `
                <div class="tile-content-item">
                    <span>●</span>
                    <span>Давление: ${data.main.pressure} гПа</span>
                </div>
                <div class="tile-content-item">
                    <span>●</span>
                    <span>Стабильность: Стабильная</span>
                </div>
            `;
        }

        function getMoonTimes() {
            const now = new Date();
            const rise = new Date(now);
            rise.setHours(16, 30);
            const set = new Date(now);
            set.setHours(6, 15);
            
            return {
                rise: formatTime(rise),
                set: formatTime(set)
            };
        }

        function updateTemperatureIcon(weatherMain, temperature) {
            const iconElement = document.getElementById('temperature-icon');
            iconElement.textContent = getWeatherIcon(weatherMain, temperature);
        }

        function getWeatherIcon(weatherMain, temperature) {
            const main = weatherMain.toLowerCase();
            const isNight = isCurrentlyNight();
            
            if (isNight) {
                switch(main) {
                    case 'clear': return '●';
                    case 'clouds': return '●';
                    case 'rain': return '●';
                    case 'snow': return '●';
                    case 'thunderstorm': return '●';
                    case 'drizzle': return '●';
                    case 'mist': case 'fog': case 'haze': return '●';
                    default: return '●';
                }
            } else {
                switch(main) {
                    case 'clear': return '●';
                    case 'clouds': 
                        if (temperature > 20) return '●';
                        return '●';
                    case 'rain': 
                        if (temperature > 15) return '●';
                        return '●';
                    case 'snow': return '●';
                    case 'thunderstorm': return '●';
                    case 'drizzle': return '●';
                    case 'mist': case 'fog': case 'haze': return '●';
                    default: return '●';
                }
            }
        }

        function isCurrentlyNight() {
            const now = new Date();
            const hour = now.getHours();
            return hour < 6 || hour > 20;
        }

        function getWindDirection(degrees) {
            const directions = currentLang === 'ru' 
                ? ['С', 'СВ', 'В', 'ЮВ', 'Ю', 'ЮЗ', 'З', 'СЗ']
                : ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];
            const index = Math.round(degrees / 45) % 8;
            return directions[index];
        }

        function formatTime(date) {
            return date.toLocaleTimeString(currentLang === 'ru' ? 'ru-RU' : 'en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            });
        }

        function calculateUVIndex(data) {
            const hour = new Date().getHours();
            const isDay = hour > 6 && hour < 20;
            const cloudFactor = 1 - (data.clouds.all / 100) * 0.7;
            
            let index, text, protection;
            
            if (!isDay) {
                index = 0;
                text = currentLang === 'ru' ? 'низкий' : 'low';
                protection = getTranslation('no_protection');
            } else if (cloudFactor > 0.7) {
                index = Math.round(8 * cloudFactor);
                text = currentLang === 'ru' ? 'высокий' : 'high';
                protection = currentLang === 'ru' ? 'Нужна защита' : 'Protection needed';
            } else {
                index = Math.round(3 * cloudFactor);
                text = currentLang === 'ru' ? 'низкий' : 'low';
                protection = getTranslation('no_protection');
            }
            
            return { index, text, protection };
        }

        function getRandomGeomagnetic() {
            const statuses = currentLang === 'ru' 
                ? [getTranslation('calm'), 'Неустойчивое', 'Возбужденное'] 
                : [getTranslation('calm'), 'Unstable', 'Active'];
            return {
                status: statuses[Math.floor(Math.random() * statuses.length)],
                value: Math.floor(Math.random() * 3) + 2
            };
        }

        function getRandomPollen() {
            const activities = currentLang === 'ru' 
                ? [getTranslation('no_activity'), 'Низкая активность', 'Средняя активность'] 
                : [getTranslation('no_activity'), 'Low activity', 'Medium activity'];
            const risks = currentLang === 'ru' 
                ? [getTranslation('no_allergy'), 'Низкий риск аллергии', 'Средний риск аллергии'] 
                : [getTranslation('no_allergy'), 'Low allergy risk', 'Medium allergy risk'];
            
            const index = Math.floor(Math.random() * activities.length);
            return {
                activity: activities[index],
                risk: risks[index]
            };
        }

        function updateThemeByWeather(weatherMain, sys) {
            if (currentTheme !== 'dynamic') return;

            const now = new Date();
            const currentTime = now.getTime();
            const sunrise = sys.sunrise * 1000;
            const sunset = sys.sunset * 1000;
            
            const isNight = currentTime < sunrise || currentTime > sunset;
            const themeClass = isNight ? 'night' : weatherMain.toLowerCase();
            
            document.body.className = themeClass;
        }

        function updateMapLocation(lat, lon) {
            if (map) {
                map.setCenter([lat, lon], 13);
                if (userPlacemark) {
                    userPlacemark.geometry.setCoordinates([lat, lon]);
                }
            }
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function initMap() {
            ymaps.ready(function() {
                map = new ymaps.Map('map', {
                    center: [55.7558, 37.6173],
                    zoom: 10
                });

                map.controls.remove('zoomControl');
                map.controls.remove('geolocationControl');
                map.controls.remove('searchControl');
                map.controls.remove('trafficControl');
                map.controls.remove('typeSelector');
                map.controls.remove('fullscreenControl');
                map.controls.remove('rulerControl');

                document.querySelector('.map-loading').style.display = 'none';
                getUserLocation();
            });
        }

        function getUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        getWeatherByCoords(lat, lng);
                        
                        userPlacemark = new ymaps.Placemark([lat, lng], {
                            balloonContent: 'Ваше местоположение'
                        }, {
                            preset: 'islands#blueCircleDotIcon'
                        });
                        
                        map.geoObjects.add(userPlacemark);
                    },
                    error => {
                        console.log('Геолокация недоступна:', error);
                        getWeatherByCity('Moscow');
                    }
                );
            } else {
                getWeatherByCity('Moscow');
            }
        }

        document.getElementById('locate-btn').addEventListener('click', () => {
            getUserLocation();
        });

        document.getElementById('city-search').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const city = e.target.value.trim();
                if (city) {
                    getWeatherByCity(city);
                }
            }
        });

        const settingsBtn = document.getElementById('settings-btn');
        const settingsOverlay = document.getElementById('settings-overlay');
        const languageBtn = document.getElementById('language-btn');
        const languageDropdown = document.getElementById('language-dropdown');
        const unitsBtn = document.getElementById('units-btn');
        const unitsDropdown = document.getElementById('units-dropdown');
        const themeOptions = document.querySelectorAll('.theme-option');

        settingsBtn.addEventListener('click', () => {
            settingsOverlay.style.display = 'flex';
            document.body.classList.add('settings-open');
        });

        settingsOverlay.addEventListener('click', (e) => {
            if (e.target === settingsOverlay) {
                settingsOverlay.style.display = 'none';
                document.body.classList.remove('settings-open');
            }
        });

        languageBtn.addEventListener('click', () => {
            languageDropdown.style.display = languageDropdown.style.display === 'block' ? 'none' : 'block';
            unitsDropdown.style.display = 'none';
        });

        unitsBtn.addEventListener('click', () => {
            unitsDropdown.style.display = unitsDropdown.style.display === 'block' ? 'none' : 'block';
            languageDropdown.style.display = 'none';
        });

        document.querySelectorAll('#language-dropdown .selector-option').forEach(option => {
            option.addEventListener('click', () => {
                currentLang = option.getAttribute('data-lang');
                document.getElementById('current-lang').textContent = 
                    currentLang === 'ru' ? 'Русский' : 'English';
                languageDropdown.style.display = 'none';
                
                updateUITexts();
                
                if (userPlacemark) {
                    const coords = userPlacemark.geometry.getCoordinates();
                    getWeatherByCoords(coords[0], coords[1]);
                }
            });
        });

        document.querySelectorAll('#units-dropdown .selector-option').forEach(option => {
            option.addEventListener('click', () => {
                currentUnits = option.getAttribute('data-units');
                document.getElementById('current-units').textContent = option.textContent;
                unitsDropdown.style.display = 'none';
            });
        });

        themeOptions.forEach(option => {
            option.addEventListener('click', () => {
                themeOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                currentTheme = option.getAttribute('data-theme');
                
                if (currentTheme === 'light') {
                    document.body.style.background = 'linear-gradient(135deg, #87CEEB, #E0F7FA)';
                    document.body.style.color = '#333';
                } else if (currentTheme === 'dark') {
                    document.body.style.background = 'linear-gradient(135deg, #2C3E50, #34495E)';
                    document.body.style.color = '#FFFFFF';
                } else {
                    document.body.style.background = '';
                    document.body.style.color = '';
                }
            });
        });

        document.addEventListener('DOMContentLoaded', () => {
            initMap();
            updateUITexts();
            
            document.getElementById('city-search').addEventListener('input', (e) => {
                showSuggestions(e.target.value);
            });
            
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.search-container')) {
                    document.getElementById('search-suggestions').style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>